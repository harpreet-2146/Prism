{{!-- Document Export Template --}}
<div class="page-header">
  <h1>{{title}}</h1>
  {{#if options.includeMetadata}}
  <div class="subtitle">
    Document Export - {{formatDate generated.timestamp 'long'}}
    {{#if metadata.exportedBy}}
    <br>Exported by {{metadata.exportedBy.fullName}}
    {{/if}}
  </div>
  {{/if}}
</div>

{{#if statistics}}
<div class="statistics">
  <h2 class="section-title">Export Summary</h2>
  <div class="stat-row">
    <span class="stat-label">Total Documents:</span>
    <span class="stat-value">{{statistics.itemCount}}</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Total Size:</span>
    <span class="stat-value">{{statistics.totalSizeFormatted}}</span>
  </div>
  <div class="stat-row">
    <span class="stat-label">Average Document Size:</span>
    <span class="stat-value">{{formatFileSize statistics.avgDocumentSize}}</span>
  </div>
</div>
{{/if}}

{{#each processedItems}}
<div class="content-section">
  <div class="item-card">
    <div class="item-title">{{originalName}}</div>
    
    {{#if ../options.includeMetadata}}
    <div class="item-meta">
      <strong>File Size:</strong> {{fileSizeFormatted}} | 
      <strong>Type:</strong> {{mimeType}} | 
      <strong>Status:</strong> {{status}}
      <br>
      <strong>Uploaded:</strong> {{createdAtFormatted}}
      {{#if processedAt}}
      | <strong>Processed:</strong> {{formatDate processedAt 'medium'}}
      {{/if}}
      {{#if category}}
      <br><strong>Category:</strong> {{category}}
      {{/if}}
      {{#if tags}}
      <br><strong>Tags:</strong> {{#each tags}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}
      {{/if}}
    </div>
    {{/if}}

    {{#if summary}}
    <div class="document-summary">
      <h4>Document Summary</h4>
      <p>{{summary}}</p>
    </div>
    {{/if}}

    {{#if extractedText}}
    <div class="document-content">
      <h4>Document Content</h4>
      {{#if textTruncated}}
      <div class="truncation-notice">
        <em>Content truncated for export. Showing first 5,000 characters.</em>
      </div>
      <div class="content-text">{{extractedTextTruncated}}</div>
      {{else}}
      <div class="content-text">{{extractedText}}</div>
      {{/if}}
    </div>
    {{/if}}

    {{#if ../options.includeMetadata}}
    {{#if sapMetadata}}
    <div class="sap-metadata-section">
      <h4>SAP Metadata</h4>
      
      {{#if sapMetadata.tcodes}}
      {{#ifGreater sapMetadata.tcodeCount 0}}
      <div class="metadata-row">
        <span class="metadata-label">Transaction Codes ({{sapMetadata.tcodeCount}}):</span>
        <div class="tcode-list">
          {{#each sapMetadata.tcodes}}
          {{{formatTCode this}}}{{#unless @last}} {{/unless}}
          {{/each}}
        </div>
      </div>
      {{/ifGreater}}
      {{/if}}

      {{#if sapMetadata.modules}}
      {{#ifGreater sapMetadata.moduleCount 0}}
      <div class="metadata-row">
        <span class="metadata-label">SAP Modules ({{sapMetadata.moduleCount}}):</span>
        <div class="module-list">
          {{#each sapMetadata.modules}}
          <span class="sap-module">{{this}}</span>
          {{/each}}
        </div>
      </div>
      {{/ifGreater}}
      {{/if}}

      {{#if sapMetadata.errorCodes}}
      {{#ifGreater sapMetadata.errorCodeCount 0}}
      <div class="metadata-row">
        <span class="metadata-label">Error Codes ({{sapMetadata.errorCodeCount}}):</span>
        <div class="error-code-list">
          {{#each sapMetadata.errorCodes}}
          <code>{{this}}</code>{{#unless @last}}, {{/unless}}
          {{/each}}
        </div>
      </div>
      {{/ifGreater}}
      {{/if}}

      {{#if sapMetadata.processes}}
      {{#ifGreater sapMetadata.processes.length 0}}
      <div class="metadata-row">
        <span class="metadata-label">Business Processes:</span>
        <ul class="process-list">
          {{#each sapMetadata.processes}}
          <li>{{this}}</li>
          {{/each}}
        </ul>
      </div>
      {{/ifGreater}}
      {{/if}}
    </div>
    {{/if}}
    {{/if}}

    {{#if ../options.includeImages}}
    {{#if images}}
    {{#ifGreater images.length 0}}
    <div class="images-section">
      <h4>Document Images ({{images.length}})</h4>
      <div class="image-grid">
        {{#each images}}
        <div class="image-item">
          <div class="image-meta">
            <strong>{{filename}}</strong>
            {{#if width}}({{width}}x{{height}}){{/if}}
            - {{formatFileSize size}}
            {{#if pageNumber}}- Page {{pageNumber}}{{/if}}
          </div>
        </div>
        {{/each}}
      </div>
    </div>
    {{/ifGreater}}
    {{/if}}
    {{/if}}

    {{#if ../options.includeMetadata}}
    <div class="technical-metadata">
      <h4>Technical Information</h4>
      <div class="metadata-grid">
        <div class="metadata-row">
          <span class="metadata-label">File Size:</span>
          {{fileSizeFormatted}}
        </div>
        <div class="metadata-row">
          <span class="metadata-label">MIME Type:</span>
          {{mimeType}}
        </div>
        <div class="metadata-row">
          <span class="metadata-label">Processing Status:</span>
          <span class="status-{{status}}">{{status}}</span>
        </div>
        {{#if extractedText}}
        <div class="metadata-row">
          <span class="metadata-label">Text Length:</span>
          {{extractedText.length}} characters
        </div>
        <div class="metadata-row">
          <span class="metadata-label">Word Count:</span>
          {{wordCount extractedText}} words
        </div>
        {{/if}}
        <div class="metadata-row">
          <span class="metadata-label">Document ID:</span>
          <code>{{id}}</code>
        </div>
      </div>
    </div>
    {{/if}}
  </div>
</div>

{{#unless @last}}
<div class="page-break"></div>
{{/unless}}
{{/each}}

<div class="footer-info">
  <p>Generated by PRISM Document Management System v{{generated.version}}</p>
  <p>Export completed on {{formatDate generated.timestamp 'datetime'}}</p>
  {{#if options.includeMetadata}}
  <p>Total documents processed: {{statistics.itemCount}}</p>
  {{/if}}
</div>

<style>
{{{styles}}}

/* Document-specific styles */
.document-summary {
  background: #e8f5e8;
  border-left: 4px solid #4caf50;
  padding: 12px;
  margin: 15px 0;
  border-radius: 4px;
}

.document-summary h4 {
  margin: 0 0 8px 0;
  color: #2e7d32;
  font-size: 14px;
}

.document-content {
  margin: 20px 0;
}

.document-content h4 {
  color: {{theme.primaryColor}};
  font-size: 14px;
  margin-bottom: 10px;
  border-bottom: 2px solid {{theme.primaryColor}};
  padding-bottom: 5px;
}

.content-text {
  background: #fafafa;
  border: 1px solid #e0e0e0;
  padding: 15px;
  border-radius: 6px;
  font-size: 11px;
  line-height: 1.6;
  white-space: pre-wrap;
  word-wrap: break-word;
  max-height: 400px;
  overflow-y: auto;
}

.truncation-notice {
  background: #fff3cd;
  border: 1px solid #ffeaa7;
  color: #856404;
  padding: 8px 12px;
  border-radius: 4px;
  margin-bottom: 10px;
  font-size: 11px;
}

.sap-metadata-section {
  background: #f0f8ff;
  border: 1px solid #cce7ff;
  border-radius: 6px;
  padding: 15px;
  margin: 15px 0;
}

.sap-metadata-section h4 {
  color: #1976d2;
  margin: 0 0 12px 0;
  font-size: 14px;
}

.tcode-list, .module-list, .error-code-list {
  margin: 5px 0;
  line-height: 1.8;
}

.tcode {
  background: {{theme.primaryColor}};
  color: {{theme.headerColor}};
  padding: 2px 6px;
  border-radius: 4px;
  font-family: 'Courier New', monospace;
  font-size: 11px;
  font-weight: bold;
  margin: 0 3px;
}

.sap-module {
  background: #4caf50;
  color: white;
  padding: 3px 8px;
  border-radius: 4px;
  font-size: 10px;
  margin: 2px;
  display: inline-block;
}

.error-code-list code {
  background: #ffebee;
  color: #c62828;
  border: 1px solid #ffcdd2;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 10px;
}

.process-list {
  margin: 5px 0 5px 20px;
  padding: 0;
}

.process-list li {
  margin: 3px 0;
  font-size: 11px;
}

.images-section {
  margin: 20px 0;
  background: #f9f9f9;
  padding: 15px;
  border-radius: 6px;
}

.images-section h4 {
  color: {{theme.primaryColor}};
  margin: 0 0 10px 0;
}

.image-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 10px;
}

.image-item {
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
  padding: 8px;
}

.image-meta {
  font-size: 10px;
  color: #666;
}

.technical-metadata {
  background: #f5f5f5;
  border: 1px solid #ddd;
  border-radius: 6px;
  padding: 15px;
  margin: 20px 0;
}

.technical-metadata h4 {
  color: #666;
  margin: 0 0 10px 0;
  font-size: 13px;
}

.metadata-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
}

.metadata-row {
  display: flex;
  justify-content: space-between;
  padding: 4px 0;
  border-bottom: 1px solid #eee;
  font-size: 11px;
}

.metadata-row:last-child {
  border-bottom: none;
}

.metadata-label {
  font-weight: bold;
  color: #666;
  flex: 0 0 40%;
}

.status-COMPLETED {
  color: #4caf50;
  font-weight: bold;
}

.status-PROCESSING {
  color: #ff9800;
  font-weight: bold;
}

.status-FAILED {
  color: #f44336;
  font-weight: bold;
}

.status-PENDING {
  color: #2196f3;
  font-weight: bold;
}

@media print {
  .document-content {
    page-break-inside: avoid;
  }
  
  .content-text {
    max-height: none;
    overflow: visible;
  }
  
  .metadata-grid {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 600px) {
  .metadata-grid {
    grid-template-columns: 1fr;
  }
  
  .image-grid {
    grid-template-columns: 1fr;
  }
}
</style>